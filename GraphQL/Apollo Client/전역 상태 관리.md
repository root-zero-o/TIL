# Apollo Clientë¡œ ì „ì—­ ìƒíƒœ ê´€ë¦¬í•˜ê¸° ğŸ””

Apollo ClientëŠ” GraphQLì„ ì‚¬ìš©í•´ ì„œë²„ì™€ í†µì‹ ì„ í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ì§€ë§Œ, ì„œë²„ ì—†ì´ ë…ë¦½ì ìœ¼ë¡œ ì „ì—­ìƒíƒœê´€ë¦¬ë¥¼ í•˜ëŠ” ë°ì—ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
<br>
íŠ¹íˆ Apollo Clientì—ì„œ ì œê³µí•˜ëŠ” makeVarë¥¼ í†µí•´ ë°˜ì‘ ë³€ìˆ˜(Reactive variables)ë¥¼ ë§Œë“¤ì–´ ìŠ¤í† ì–´ë¥¼ ë§Œë“ ë‹¤.

## ë°˜ì‘ ë³€ìˆ˜(Reactive variables)
- ë°˜ì‘ ë³€ìˆ˜ëŠ” Apollo Client ìºì‹œ ë°–ì—ì„œ local stateë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
- ë°˜ì‘ ë³€ìˆ˜ì—ëŠ” ì–´ë–¤ íƒ€ì…ì´ë‚˜ êµ¬ì¡°ì˜ ë°ì´í„°ë¼ë„ ì €ì¥í•  ìˆ˜ ìˆìœ¼ë©°, GraphQL ë¬¸ë²• ì—†ì´ë„ app ì–´ë””ì„œë“  ê°’ì„ ì €ì¥í•˜ê³  ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.
- ë°˜ì‘ ë³€ìˆ˜ë¥¼ modifyí•˜ëŠ” ê²ƒì€ ê·¸ ë³€ìˆ˜ì— ì˜ì¡´í•˜ëŠ” ì¿¼ë¦¬ì˜ ì—…ë°ì´íŠ¸ë¥¼ íŠ¸ë¦¬ê±°í•œë‹¤. <br>(Most importantly, modifying a reactive variable triggers an update of every active query that depends on that variable.)

## Setting
```typescript
// pages/client.tsx

import { ApolloClient, InMemoryCache } from "@apollo/client";
import todoVar from "../store/todo";

// ë§Œë“  Todo ë°ì´í„°ë¥¼ GraphQL ì¿¼ë¦¬ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ ë¡œì»¬ ì „ìš© í•„ë“œì— ë“±ë¡í•œë‹¤.
// InMemoryCache typePoliciesì— ì •ì˜í•´ì¤€ë‹¤.
// read í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´ todoVarë¥¼ ì‹¤í–‰í•´ Todoë°ì´í„°ë¥¼ ë°˜í™˜í•´ì¤€ë‹¤.

const cache = new InMemoryCache({
  typePolicies: {
    Query: {
      fields: {
        // read í•¨ìˆ˜ê°€ ì •ì˜ëœ í•„ë“œëŠ” ì¿¼ë¦¬ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ í•´ë‹¹ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ í•„ë“œ ê°’ì„ ê³„ì‚°í•œë‹¤.
        // ë¡œì»¬ ìƒíƒœëŠ” ìºì‹±ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— read í•¨ìˆ˜ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì•¼ í•œë‹¤.
        getTodos: {
          read() {
            return todoVar();
          },
        },
      },
    },
  },
});

const client = new ApolloClient({
  cache,
});

export default client;

```

## Creating
```typescript
import { makeVar } from "@apollo/client";  // import í•´ì£¼ê¸°

const todoIdCounterVar = makeVar(0);  // ì¸ìì—ëŠ” ì´ˆê¸°ê°’ì´ ë“¤ì–´ê°„ë‹¤.
const todoVar = makeVar<Todo[]>([]);
```

## Reading

```typescript
// components/TodoContainer.tsx

import { useReactiveVar } from "@apollo/client";
import React from "react";
import todoVar, { Todo } from "../store/todo";
import TodoItem from "./TodoItem";

const TodoContainer = () => {
  // useReactiveVarë¥¼ ì‚¬ìš©í•´ ì§ì ‘ ë°˜ì‘ ë³€ìˆ˜ì—ì„œ ìƒíƒœë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
  // cacheì— ì •ì˜ë¥¼ í•˜ì§€ ì•Šì•„ë„ ë˜ê³ , ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
  // useQueryë¥¼ ì‚¬ìš©í•˜ë©´ Todo ë°ì´í„°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ Todo ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì¿¼ë¦¬ê°€ íŠ¸ë¦¬ê±°ëœë‹¤.
  // í•˜ì§€ë§Œ useReactiveVarë¥¼ ì‚¬ìš©í•˜ë©´ ë…ë¦½ì ì´ë‹¤.
  const todos = useReactiveVar(todoVar);

  return (
    <div>
      {todos.map((todo, idx) => {
        return (
          <TodoItem
            key={idx}
            id={todo.id}
            content={todo.content}
            done={todo.done}
          />
        );
      })}
    </div>
  );
};

export default TodoContainer;
```

## Modifying

```typescript
// store/todo.ts

...

export const addTodo = (content: string) => {
  // ì¸ìë¥¼ ë„£ì§€ ì•Šê³  í˜¸ì¶œí•˜ë©´ í•´ë‹¹ ë°˜ì‘ ë³€ìˆ˜ì˜ ê°’ì´ ë³€í™˜ëœë‹¤.
  const prevId = todoIdCounterVar();
  const curTodo = todoVar();
  const newTodo = {
    id: prevId + 1,
    content,
    done: false,
  };
  // ì¸ìë¥¼ ë„£ê³  í˜¸ì¶œí•˜ë©´ ì¸ì ê°’ìœ¼ë¡œ ë°˜ì‘ ë³€ìˆ˜ê°€ ì—…ë°ì´íŠ¸ ëœë‹¤.
  todoVar([...curTodo, newTodo]);
  todoIdCounterVar(prevId + 1);
};

...

```
ìœ„ì—ì„œ ë§Œë“  í•¨ìˆ˜ë¥¼ ì´ë²¤íŠ¸ í•¨ìˆ˜ì— ë„£ì–´ì„œ ì‹¤í–‰í•´ì¤€ë‹¤.

```
const [input, setInput] = useState("");
  const onSubmit = (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    addTodo(input);  // í•¨ìˆ˜ ì‹¤í–‰
    alert("ì…ë ¥ ì™„ë£Œ!");
    setInput("");
  };
```

## ì°¸ê³ 
- https://www.apollographql.com/docs/react/local-state/reactive-variables/
- https://chanyeong.com/blog/post/45









